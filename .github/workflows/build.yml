name: Build and Export iOS App

on:
  push:
    branches:
      - main

jobs:
  build:

    runs-on: macos-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set up Xcode
      uses: actions/setup-xcode@v2
      with:
        xcode-version: '13.0'


    - name: Build
      run: |
        xcodebuild build -scheme "UpgradeUpsell" -sdk iphoneos -destination generic/platform=iOS

    - name: Archive
      run: |
        xcodebuild archive -scheme "UpgradeUpsell" -sdk iphoneos -destination generic/platform=iOS -archivePath ./build/UpgradeUpsell.xcarchive

    - name: Export IPA
      run: |
        xcodebuild -exportArchive -archivePath ./build/UpgradeUpsell.xcarchive -exportOptionsPlist ./ExportOptions.plist -exportPath ./build

    - name: Upload IPA
      uses: actions/upload-artifact@v2
      with:
        name: ipa
        path: ./build/*.ipa
